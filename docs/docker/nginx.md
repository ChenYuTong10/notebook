# ‚öôÔ∏è Nginx

## üëÄ What is nginx

`Nginx` (pronounced "engine x") is a popular open-source web server software that is widely used to serve static and dynamic content on the web. It was first released in 2004 by Igor Sysoev, and has since become one of the most popular web servers in use today.

Nginx is known for its high performance and low resource usage, making it particularly well-suited for serving high-traffic websites and applications. It uses an asynchronous, event-driven architecture to handle requests, which allows it to handle a large number of simultaneous connections with relatively low memory usage.

In addition to its use as a web server, Nginx is also often used as a reverse proxy, load balancer, and HTTP cache. It supports a wide range of protocols, including HTTP, HTTPS, SMTP, POP3, and IMAP, and can be used with a variety of programming languages and frameworks.

Overall, Nginx is a versatile and powerful tool that is essential for many web developers and system administrators.

::: tip
All above is generated by `ChatGPT`.ü•±
:::

## üî® How to run nginx

Usually, nginx will be installed directly on the host machine.
It acts as a gateway to distribute the request from outside and transmit to the back-end.

Here I will introduce how to install nginx on host machine briefly and Docker mainly.

::: warning
The host machine used in this note is **Ubuntu 20.04**.
:::

### üíª Host machine

`Nginx` is available in Ubuntu's repositories, so you can install it by following commands.

```shell
$ sudo apt update
$ sudo apt install nginx
```

Now you can open <a target='_blank'>http://127.0.0.1</a> on your web browser.

If the host machine refuses to connect, you can check the firewall on Ubuntu.
More information you can look at [here](https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-ubuntu-20-04).

### üêã Docker

Here is the simplest way to run the nginx in docker.

```shell
$ sudo docker run --name ${container-name} -p 80:80 -p 443:443 -d nginx:latest
```

- `--name` provides a specific container name.
- `-p` points the exposed container ports.
- `-d` means running container in background.

::: tip
More syntax to see the [docker official documentation](https://docs.docker.com/engine/reference/builder/).
:::

Sometimes, we may want to install some packages in the nginx image.
So we need to write a dockerfile to build our custom image.
The following is a sample.

```dockerfile
# you can choose other mirrors of nginx on https://hub.docker.com/_/nginx
FROM nginx:alpine

# using root user to install the package you need.
USER root

# set alpine mirror
# tsinghua mirror
RUN sed -i "s/dl-cdn.alpinelinux.org/mirrors.ustc.edu.cn/g" /etc/apk/repositories

# update packages
RUN apk update

# install needed packages
RUN apk add --no-cache rsync sudo vim bash curl

RUN apk upgrade

EXPOSE 80
EXPOSE 443

ENTRYPOINT [ "nginx", "-g", "daemon off;" ]
```

After writing Dockerfile, we need to build the image as following.
Do not forget to replace the `${image-name}` to your desired name.

```shell
$ sudo docker build . -t ${image-name}
```

Finally, running the image in a container.

```shell
$ sudo docker run --name ${container-name} -p 80:80 -p 443:443 -d ${image-name}
```

## üí° Advanced Settings

### SSL Certificate

**HTTPS** is an important requirement to ensure the security between the communication.
Enable HTTPS needs a ssl certificate, you can get a free on from [Let's Encrypt](https://geekrewind.com/setup-lets-encrypt-wildcard-on-ubuntu-20-04-18-04/).

<hr/>
After getting a ssl certificate, we need to configure the ssl settings in `nginx.conf` file like following.

```txt
server {
    listen       443 ssl;
    server_name  localhost;
    
    # ssl certificate settings
    ssl_protocols           TLSv1 TLSv1.1 TLSv1.2;
    ssl_certificate         ${ssl-certificate};
    ssl_certificate_key     ${ssl-key};
    
    location / {
        root        /var/www/html/;
        index       index.html index.htm;
    }

    access_log  /var/log/nginx/access.log;
    error_log   /var/log/nginx/error.log;

    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   html;
    }
}
```

And running the command.

```shell
$ docker run \
 --name ${container-name} \
 -p 80:80 -p 443:443 \
 -v /etc/letsencrypt:/etc/letsencrypt \
 -v ${conf-path}:${conf-path} \
 -d ${image-name}
```

Finally, open your web browser and test [https://127.0.0.1](https://127.0.0.1/).

## üì¶ Conclusion

This note only gives the main configuration of the whole. If you need more, you can search it by yourself.
This is my real [configuration](https://github.com/ChenYuTong10/10note/releases/tag/0.0) on production environment. You can have a reference if interested it.
